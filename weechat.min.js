!function(a){!function(){function b(){for(;e.match(/^[\*\/\_\|]/);)h.push(e.charAt(0)),e=e.slice(1)}function c(){var a;return e.match(/^@/)?(a=e.slice(1,6),e=e.slice(6)):(a=e.slice(0,2),e=e.slice(2)),a}function d(a){if(!a)return a;var b,c=a.split(/(\x19|\x1A|\x1B|\x1C)/);return 1===c.length?[{text:c[0]}]:(h=[],c.map(function(a){var c,d=j[a.charAt(0)];return b&&(e=a,b(),c={text:e,fg:i[parseInt(f,10)],bg:i[parseInt(g,10)],attrs:h},c.fg||(c.fg=f),c.bg||(c.bg=g)),b=d,c}).filter(function(a){return a}))}var e,f,g,h,i=["#000000","#AA0000","#00AA00","#AA5500","#0000AA","#AA00AA","#00AAAA","#AAAAAA","#555555","#FF5555","#55FF55","#FFFF55","#5555FF","#FF55FF","#55FFFF","#FFFFFF","#000000","#00005F","#000087","#0000AF","#0000D7","#0000FF","#005F00","#005F5F","#005F87","#005FAF","#005FD7","#005FFF","#008700","#00875F","#008787","#0087AF","#0087D7","#00AF00","#00AF5F","#00AF87","#00AFAF","#00AFD7","#00AFFF","#00D700","#00D75F","#00D787","#00D7AF","#00D7D7","#00D7FF","#00FF00","#00FF5F","#00FF87","#00FFAF","#00FFD7","#00FFFF","#5F0000","#5F005F","#5F0087","#5F00AF","#5F00D7","#5F00FF","#5F5F00","#5F5F5F","#5F5F87","#5F5FAF","#5F5FD7","#5F5FFF","#5F8700","#5F875F","#5F8787","#5F87AF","#5F87D7","#5F87FF","#5FAF00","#5FAF5F","#5FAF87","#5FAFAF","#5FAFD7","#5FAFFF","#5FD700","#5FD75F","#5FD787","#5FD7AF","#5FD7D7","#5FD7FF","#5FFF00","#5FFF5F","#5FFF87","#5FFFAF","#5FFFD7","#5FFFFF","#870000","#87005F","#870087","#8700AF","#8700D7","#8700FF","#875F00","#875F5F","#875F87","#875FAF","#875FD7","#875FFF","#878700","#87875F","#878787","#8787AF","#8787D7","#8787FF","#87AF00","#87AF5F","#87AF87","#87AFAF","#87AFD7","#87AFFF","#87D700","#87D75F","#87D787","#87D7AF","#87D7D7","#87D7FF","#87FF00","#87FF5F","#87FF87","#87FFAF","#87FFD7","#87FFFF","#AF0000","#AF005F","#AF0087","#AF00AF","#AF00D7","#AF00FF","#AF5F00","#AF5F5F","#AF5F87","#AF5FAF","#AF5FD7","#AF5FFF","#AF8700","#AF875F","#AF8787","#AF87AF","#AF87D7","#AF87FF","#AFAF00","#AFAF5F","#AFAF87","#AFAFAF","#AFAFD7","#AFAFFF","#AFD700","#AFD75F","#AFD787","#AFD7AF","#AFD7D7","#AFD7FF","#AFFF00","#AFFF5F","#AFFF87","#AFFFAF","#AFFFD7","#AFFFFF","#D70000","#D7005F","#D70087","#D700AF","#D700D7","#D700FF","#D75F00","#D75F5F","#D75F87","#D75FAF","#D75FD7","#D75FFF","#D78700","#D7875F","#D78787","#D787AF","#D787D7","#D787FF","#D7AF00","#D7AF5F","#D7AF87","#D7AFAF","#D7AFD7","#D7AFFF","#D7D700","#D7D75F","#D7D787","#D7D7AF","#D7D7D7","#D7D7FF","#D7FF00","#D7FF5F","#D7FF87","#D7FFAF","#D7FFD7","#D7FFFF","#FF0000","#FF005F","#FF0087","#FF00AF","#FF00D7","#FF00FF","#FF5F00","#FF5F5F","#FF5F87","#FF5FAF","#FF5FD7","#FF5FFF","#FF8700","#FF875F","#FF8787","#FF87AF","#FF87D7","#FF87FF","#FFAF00","#FFAF5F","#FFAF87","#FFAFAF","#FFAFD7","#FFAFFF","#FFD700","#FFD75F","#FFD787","#FFD7AF","#FFD7D7","#FFD7FF","#FFFF00","#FFFF5F","#FFFF87","#FFFFAF","#FFFFD7","#FFFFFF","#080808","#121212","#1C1C1C","#262626","#303030","#3A3A3A","#444444","#4E4E4E","#585858","#626262","#6C6C6C","#767676","#808080","#8A8A8A","#949494","#9E9E9E","#A8A8A8","#B2B2B2","#BCBCBC","#C6C6C6","#D0D0D0","#DADADA","#E4E4E4","#EEEEEE"],j={"":function(){e.match(/^F/)?(e=e.slice(1),b(),f=c()):e.match(/^B/)?(e=e.slice(1),b(),g=c()):(b(),f=c(),e.match(/^,/)&&(e=e.slice(1),g=c()))},"":function(){},"":function(){h=[]},"":function(){f="",g=""}};a.color=d}(),function(){function b(a){function b(b){j.setData(b);var c=j.getString(),d=j.parse();a&&a(c,d),h=0}function d(a){if(j.setData(a),j.getInt(),compression=j.getChar(),a=j.getData(),compression){if(!c)throw new Error("Zlib is currently not available");i=!0,c.unzip(a,function(a,c){if(i=!1,a)throw a;b(c),f.onData()})}else b(a),f.onData()}function e(a,b){var c=new Buffer(a.length+b.length);return a.copy(c),b.copy(c,a.length),c}var f=this,g=new Buffer(0),h=0,i=!1,j=new Protocol;f.onData=function(a){var b;a&&(g=e(g,a)),!i&&g.length>4&&(0===h&&(j.setData(g),h=j.getInt()),g.length>=h&&(b=g.slice(0,h),g=g.slice(h),h=0,d(b)))}}var c;this.require&&(c=require("zlib")),a.Parser=b}(),function(){var a=function(){this._types={chr:this._getChar,"int":this._getInt,str:this._getString,inf:this._getInfo,hda:this._getHdata,ptr:this._getPointer,lon:this._getStrNumber,tim:this._getTime,buf:this._getString,arr:this._getArray,htb:this._getHashTable,inl:function(){this._warnUnimplemented("infolist")}},this._typesStr={chr:this._strDirect,str:this._strDirect,"int":this._strToString,tim:this._strToString,ptr:this._strDirect}};a._uia2s=function(a){for(var b=[],c=0;c<a.length;c++)b.push(String.fromCharCode(a[c]));return decodeURIComponent(escape(b.join("")))},a._mergeParams=function(a,b){for(var c in b)a[c]=b[c];return a},a._formatCmd=function(a,b,c){var d,e;return d=null!==a?"("+a+") ":"",d+=b,c.unshift(d),e=c.join(" "),e+="\n"},a.formatInit=function(b){var c={password:null,compression:"off"},d=[],e=[];return b=a._mergeParams(c,b),d.push("compression="+b.compression),null!==b.password&&d.push("password="+b.password),e.push(d.join(",")),a._formatCmd(null,"init",e)},a.formatHdata=function(b){var c={id:null,keys:null},d=[];return b=a._mergeParams(c,b),d.push(b.path),null!==b.keys&&d.push(b.keys.join(",")),a._formatCmd(b.id,"hdata",d)},a.formatInfo=function(b){var c={id:null},d=[];return b=a._mergeParams(c,b),d.push(b.name),a._formatCmd(b.id,"info",d)},a.formatNicklist=function(b){var c={id:null,buffer:null},d=[];return b=a._mergeParams(c,b),null!==b.buffer&&d.push(b.buffer),a._formatCmd(b.id,"nicklist",d)},a.formatInput=function(b){var c={id:null},d=[];return b=a._mergeParams(c,b),d.push(b.buffer),d.push(b.data),a._formatCmd(b.id,"input",d)},a._formatSyncDesync=function(b,c){var d={id:null,buffers:null,options:null},e=[];return c=a._mergeParams(d,c),null!==c.buffers&&(e.push(c.buffers.join(",")),null!==c.options&&e.push(c.options.join(","))),a._formatCmd(c.id,b,e)},a.formatSync=function(b){return a._formatSyncDesync("sync",b)},a.formatDesync=function(b){return a._formatSyncDesync("desync",b)},a.formatTest=function(b){var c={id:null},d=[];return b=a._mergeParams(c,b),a._formatCmd(b.id,"test",d)},a.formatQuit=function(){return a._formatCmd(null,"quit",[])},a.formatPing=function(b){var c={id:null,args:null},d=[];return b=a._mergeParams(c,b),null!==b.args&&d.push(b.args.join(" ")),a._formatCmd(b.id,"ping",d)},a.prototype={_warnUnimplemented:function(a){console.log("Warning: "+a+" message parsing is not implemented")},_getType:function(){var b=this._getSlice(3);return b?a._uia2s(new Uint8Array(b)):null},_runType:function(a){var b=this._types[a],c=b.bind(this);return c()},_getStrNumber:function(){var b=this._getByte(),c=this._getSlice(b);return a._uia2s(new Uint8Array(c))},_strDirect:function(a){return a},_strToString:function(a){return a.toString()},_objToString:function(a,b){var c=this._typesStr[b],d=c.bind(this);return d(a)},_getInfo:function(){var a={};return a.key=this._getString(),a.value=this._getString(),a},_getHdata:function(){function a(){var a={};a.pointers=b.map(function(){return d._getPointer()}),keys.forEach(function(b){a[b[0]]=d._runType(b[1])}),e.push(a)}var b,c,d=this,e=[],f=this._getString();keys=this._getString().split(","),b=f.split("/"),c=this._getInt(),keys=keys.map(function(a){return a.split(":")});for(var g=0;c>g;g++)a();return e},_getPointer:function(){return this._getStrNumber()},_getTime:function(){var a=this._getStrNumber();return new Date(1e3*parseInt(a,10))},_getInt:function(){var a=new Uint8Array(this._getSlice(4));return(255&a[0])<<24|(255&a[1])<<16|(255&a[2])<<8|255&a[3]},_getByte:function(){var a=new Uint8Array(this._getSlice(1));return a[0]},_getChar:function(){return String.fromCharCode(this._getByte())},_getString:function(){var b=this._getInt();if(b>0){var c=this._getSlice(b),d=new Uint8Array(c);return a._uia2s(d)}return""},_getHeader:function(){var a=this._getInt(),b=this._getByte();return{length:a,compression:b}},_getId:function(){return this._getString()},_getObject:function(){var a=this,b=this._getType();return b?{type:b,content:a._runType(b)}:void 0},_getHashTable:function(){var a,b,c,d=this,e={};a=this._getType(),b=this._getType(),c=this._getInt();for(var f=0;c>f;++f){var g=d._runType(a),h=d._objToString(g,a),i=d._runType(b);e[h]=i}return e},_getArray:function(){var a,b,c,d=this;a=this._getType(),b=this._getInt(),c=[];for(var e=0;b>e;e++)c.push(d._runType(a));return c},_getSlice:function(a){if(this.dataAt+a>this._data.byteLength)return null;var b=this._data.slice(this._dataAt,this._dataAt+a);return this._dataAt+=a,b},_setData:function(a){this._data=a},parse:function(a){var b=this;this._setData(a),this._dataAt=0;for(var c=this._getHeader(),d=this._getId(),e=[],f=this._getObject();f;)e.push(f),f=b._getObject();return{header:c,id:d,objects:e}}}}()}("undefined"==typeof exports?this.weechat={}:exports);